# レビューメモ

## 全体的な感想

コントローラーは scaffold で生成されるコードに近く、また薄く書こうとしている意図が見えてよいと思いました。
今回はフォルダとファイルの木構造を RDB や ActiveRecord で表現する事に苦戦されたようですが、以下の gem を使うとより楽に実装できたかもしれません。

[stefankroes/ancestry](https://github.com/stefankroes/ancestry)

トライアウトのコードレビューの動画にもあったと思うのですが、 web アプリでありがちな実装はだいたい gem 化されている場合が多いので、実装前に調べてみるのもよいですね。
あとは、モデルで where を使っている箇所が結構ありましたが、 scope にできないか、あるいは親子モデルからチェインして取得できないかどうかを意識して書くと、もっと良いコードになると思います。


## authenticate_user! について

全コントローラーの `:before_action` に書かれていましたが、 `ApplicationController` に書かれた方がコードが DRY になります。
セキュリティの観点からも、ホワイトリスト的な書き方 ( 個人認証が不要な Controller のみ、 `skip_before_action :authenticate_user!` とする ) になるので、安全ですね。

## ファイルやフォルダの認証について

`check_folder_authority` で Folder のアクセス制御はされているのですが、コントローラー側で Folder, や SharingFile, SharingFolder 全体から自分の Folder をセットし、制御している事に違和感というか、危うさを感じました。
特に `SharingFilesController` では、自分以外のファイルでも、 id を指定すれば共有できるようなコードに見えました。
`current_user` からこれらのオブジェクトを引いた方が、安全な書き方だと思います。


## UI について感じた違和感など

* Paper って何ですか ?
* 同名のファイルやフォルダが作れない場合のエラーメッセージは、もう少しわかりく表示した方がよいと感じました

## 不具合 ?

* ファイルを含むフォルダを削除するとエラー（補足されていない例外）が発生
